//test filftil arduino edition

#include "filtfilt.h"

void setup() {
    Serial.println("filt filt processing Test Begin");

    // Initialize serial and wait for port to open:
    Serial.begin(9600);
    while (!Serial) {
        ;  // wait for serial port to connect. Needed for native USB port only
    }
}

unsigned long curr_time = 0;
int period = 1000;

void loop() {
    if (millis() >= curr_time + period) {
        curr_time += period;

        vectord b_coeff = {0.52762438, 1.58287315, 1.58287315, 0.52762438};
        vectord a_coeff = {1.0, 1.76004188, 1.18289326, 0.27805992};

        // signal after median filter
        vectord input_signal = {
            0.014837679564630637,  -0.08487224188568553,  -0.1845821633360017,   -0.1845821633360017,
            -0.1845821633360017,   -0.20357459265110042,  -0.31752916854169144,  -0.3270253831992412,
            -0.34601781251433916,  -0.37450645648698694,  -0.37450645648698694,  -0.37450645648698694,
            -0.34601781251433916,  -0.37450645648698694,  -0.3934988858020857,   -0.5264452260998735,
            -0.6024149433602678,   -0.6024149433602678,   -0.6024149433602678,   -0.5454376554149722,
            -0.5359414407574226,   -0.5359414407574226,   -0.5359414407574226,   -0.5359414407574226,
            -0.5359414407574226,   -0.5264452260998735,   -0.5264452260998735,   -0.5264452260998735,
            -0.5264452260998735,   -0.5169490114423245,   -0.5074527967847747,   -0.45997172349702903,
            -0.45997172349702903,  -0.45997172349702903,  -0.45997172349702903,  -0.45997172349702903,
            -0.45047550883947923,  -0.45047550883947923,  -0.45047550883947923,  -0.48846036746967675,
            -0.48846036746967675,  -0.48846036746967675,  -0.48846036746967675,  -0.48846036746967675,
            -0.5929187287027188,   -0.6214073726753665,   -0.6214073726753665,   -0.6214073726753665,
            -0.469467938154578,    -0.469467938154578,    -0.3934988858020857,   -0.3934988858020857,
            -0.013650964408017115, -0.013650964408017115, -0.013650964408017115, -0.013650964408017115,
            -0.6783843281667107,   -0.6783843281667107,   -0.6783843281667107,   -0.649895684194063,
            -0.6119111580178168,   -0.5644300847300711,   -0.5644300847300711,   -0.45997172349702903,
            -0.1845821633360017,   -0.1845821633360017,   -0.14659730470580493,  0.024333894222180394,
            -0.14659730470580493,  -0.14659730470580493,  0.024333894222180394,  0.11929604079767188,
            0.7175562344074738,    0.8599987893628122,    0.8599987893628122,    0.8599987893628122,
            -0.31752916854169144,  -0.31752916854169144,  -0.31752916854169144,  -0.26055188059639595,
            0.3187158836983057,    0.34720452767095344,   0.7460448783801178,    0.7460448783801178,
            0.8125183809829638,    0.8125183809829638,    0.7460448783801178,    0.1952657580580669,
            0.1952657580580669,    -0.05163582303821386,  -0.05163582303821386,  0.7460448783801178,
            0.7460448783801178,    0.7460448783801178,    0.8599987893628122,    0.7460448783801178,
            0.6605789464621753,    0.6605789464621753,    0.1952657580580669,    0.1952657580580669,
            0.1952657580580669,    0.8220145956405188,    0.8315108102980678,    0.8884874333354577,
            0.8884874333354577,    0.8220145956405188,    -0.34601781251433916,  -0.34601781251433916,
            -0.34601781251433916,  -0.7923389040573025,   -0.8683082888637453,   -0.8683082888637453,
            -0.8683082888637453,   -0.8683082888637453,   1.4392672185654134,    1.4392672185654134,
            1.4392672185654134,    0.5181363915068408,    0.23324995178036323,   0.21425818737316565,
            0.21425818737316565,   0.23324995178036323,   2.075512270805412,     2.075512270805412,
            2.075512270805412,     0.17627332874296892,   0.1382884701127718,    0.10030361148257465};
        vectord y_filtfilt_ori = {
            0.014679422195641903, -0.08899343843953406, -0.17667473651319077,  -0.19540665327809031,
            -0.17198513743186333, -0.216443320300105,   -0.306250331487255,    -0.3348750955779169,
            -0.34285816931367363, -0.3725793343513689,  -0.3811051467504614,   -0.364321233261683,
            -0.3581217877981115,  -0.3626115375132509,  -0.4029160004084459,   -0.5213193412833351,
            -0.6025686236729935,  -0.606503286816932,   -0.5958651879789323,   -0.5523687843512333,
            -0.5302642375433927,  -0.539593421327724,   -0.5342509378376792,   -0.5362523402952148,
            -0.53625172429969,    -0.5262380032150598,  -0.5259317707507453,   -0.5281608388002774,
            -0.5232616781306714,  -0.5215186493332815,  -0.5020242404694208,   -0.4653453627927433,
            -0.4557025999976211,  -0.4622518510209104,  -0.46021364543265547,  -0.45710386226847904,
            -0.45557674957657235, -0.4441195051886887,  -0.45649056252469977,  -0.48479932834146944,
            -0.4878796340098644,  -0.4942710756770998,  -0.4780696197001592,   -0.500753134468076,
            -0.5831538329197747,  -0.623459175064496,   -0.6316647167155548,   -0.5960935239102805,
            -0.5097504784756897,  -0.41787806600011473, -0.4486510700452401,   -0.3463094529349889,
            -0.03990846886487928, -0.01814224662050481, 0.023429528120826458,  -0.07520439943559437,
            -0.6076982848677693,  -0.7419914860216329,  -0.6329332451949228,   -0.6735389291855632,
            -0.6075621213357417,  -0.5556043567040251,  -0.5788436978524147,   -0.4475483291463569,
            -0.18917737655485503, -0.18940036322099596, -0.1369665901648848,   0.019664718087267843,
            -0.15702174670718858, -0.1171993130345034,  -0.016989899509525196, 0.15484937947637245,
            0.7100132419066285,   0.8228300482539678,   0.9435142033125887,    0.7472891369354576,
            -0.2062899697569328,  -0.3957232553862396,  -0.2920331435772604,   -0.2315234708833528,
            0.24841978338055853,  0.4387199365829834,   0.6512094231217083,    0.8338308411261826,
            0.7346236928332057,   0.8807823056014021,   0.6895229475940459,    0.2333401434300732,
            0.18376660847881995,  -0.06984219498915749, -0.010208473174313018, 0.6959316059735093,
            0.7898916053830547,   0.715666086492003,    0.8802394598017473,    0.7256447180201069,
            0.6918986891495338,   0.6123664070549198,   0.26009501949357033,   0.11828433726432871,
            0.2791280028391941,   0.7342845004252598,   0.9242306441036507,    0.7865970592468454,
            1.0018151638496413,   0.7027825039335568,   -0.23562392982550034,  -0.42847788292636846,
            -0.3086368864546437,  -0.7716854557335395,  -0.9565678702954344,   -0.7079100173044794,
            -1.093932578830795,   -0.6018860560833508,  1.1709049556555549,    1.6706936769451621,
            1.2670231134507048,   0.6344640344832746,   0.1453075784074264,    0.3154736460861337,
            0.06043636910548475,  0.46040257167335186,  1.7810925402923548,    2.4065222401825785,
            1.7553602791191736,   0.431602193509149,    -0.004849421115009647, 0.10336052631292612};

        vectord y_filtfilt_out;
        filtfilt(b_coeff, a_coeff, input_signal, y_filtfilt_out);

        Serial.println(compare(y_filtfilt_out, y_filtfilt_ori, 0.0001));
    }
}